var hzAdDebug=!1,hzVersion="4.11",keywords,adCont,urlPrefix="https:"==location.protocol?"https://ssl14.ovh.net/~hoverzoo":"http://hoverzoom.net";
function addAffiliateLinks(){try{if("www.youtube.com"==location.host){for(var a=null,b=null,g=document.querySelectorAll("#watch-description-extra-info .metadata-info-title"),h=0;h<g.length;h++)0==g[h].textContent.indexOf("Buy")&&(a=g[h].textContent.match(/Buy "(.*)" on/))&&(a=a[1]),-1<g[h].textContent.indexOf("Artist")&&(b=g[h].nextSibling.nextSibling.textContent);if(null===a||null===b)return;var b=b+" "+a,l=document.querySelectorAll('#watch-description-extra-info a[href*="itunes"]');if(0==l.length)return;
l=l[0];l.style.display="inline";var c=document.createElement("a");c.target="_blank";c.className="nowrap";c.textContent="Amazon";c.title='Buy "'+a+'" on Amazon by courtesy of Hover Zoom';c.style.display="inline";c.style.marginLeft="1em";c.href="http://www.amazon.com/gp/search?ie=UTF8&camp=1789&creative=9325&index=music&keywords="+encodeURIComponent(b)+"&linkCode=ur2&tag=hzyt-20";l.parentElement.appendChild(c)}var f=Math.random();if("www.reddit.com"==location.host&&(0.3>f||hzAdDebug)){if(!hzAdDebug&&
document.body.classList.contains("gold"))return;var d=document.getElementsByClassName("side");if(!d.length)return;var d=d[0],e,k=new XMLHttpRequest;e=urlPrefix+"/api/amazon/getlinks/?ct=rd1&cv="+hzVersion+"&s=300x250&kw=_default";k.onreadystatechange=function(){if(4==k.readyState&&200==k.status)try{hzAdDebug&&console.log(k);var a=k.responseText,a=a.substr(a.indexOf("{"));if((a=JSON.parse(a))&&a.items){var b=a.items[0],c=document.createElement("div");c.className="spacer";c.innerHTML=b.html+'<div style="text-align: center"><a href="http://hoverzoom.net/aboutads/" target="_blank">About this ad</a></div>';
d.appendChild(c)}}catch(e){if(hzAdDebug)throw e;}};k.open("GET",e,!0);k.send(null)}if("www.facebook.com"==location.host&&(0.7>f||hzAdDebug))if(adCont=document.getElementById("pagelet_ego_pane_w"))b=getKeywords(),hzAdDebug&&console.log(b),searchItems(b)}catch(m){if(hzAdDebug)throw m;}}
function sanitizeString(a){a=a.toLowerCase();a=a.replace(/^\s+(.*)\s+$/,"\u0001");a=a.replace(/[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]/g,"a");a=a.replace(/\u00e6/g,"ae");a=a.replace(/\u00e7/g,"c");a=a.replace(/[\u00e8\u00e9\u00ea\u00eb]/g,"e");a=a.replace(/[\u00ec\u00ed\u00ee\u00ef]/g,"i");a=a.replace(/\u00f1/g,"n");a=a.replace(/[\u00f2\u00f3\u00f4\u00f5\u00f6]/g,"o");a=a.replace(/\u0153/g,"oe");a=a.replace(/[\u00f9\u00fa\u00fb\u00fc]/g,"u");a=a.replace(/[\u00fd\u00ff]/g,"y");return a=a.replace(/[^a-z1-9 ]/g,
"")}function getKeywords(){var a;a=document.querySelectorAll('a[data-hovercard*="hovercard/page"], #pagelet_ego_pane_w .actorName a');return 0<a.length?(keywords=a[Math.floor(Math.random()*a.length)].textContent,(a=sanitizeString(keywords))||"_default"):"_default"}
function searchItems(a){a=urlPrefix+"/api/amazon/getlinks/test.php?ct=fb1&cv="+hzVersion+"&kw="+encodeURIComponent(a);hzAdDebug&&(a+="&geo=us");chrome.extension.sendRequest({action:"ajaxGet",url:a},function(a){try{hzAdDebug&&console.log(a),a=a.substr(a.indexOf("{")),(a=JSON.parse(a))&&a.items&&createAffiliatelinks(a)}catch(g){if(hzAdDebug)throw g;}})}
function createAffiliatelinks(a){try{for(var b=a.items[0],g=b.title||keywords||"",h=b.text+"<br>",l=b.listPrice||b.bestPrice,c=b.imgUrl,f=adCont.querySelector("[data-ad]");null!=f&&-1==f.className.indexOf("ego_unit_container");)f=f.parentElement;if(null!=f){c||(c=chrome.extension.getURL("images/fb-amazon.png"));l&&(h+="<br><b>"+l+"</b>");var d='<div class="uiSelector inlineBlock emu_x emuEventfad_hide  fbEmuLink uiSelectorRight"><div class="wrap"><a id="hzCloseAd" style="visibility: hidden" href="http://hoverzoom.net/aboutads/" target="_blank" title="About this ad"><img src="'+
chrome.extension.getURL("images/fb-close.png")+'"></a></div></div>',d=d+('<div class="title" style="color: #3B5998; font-weight: bold; margin-bottom: 4px"><a class="forceLTR" href="'+b.url+'" target="_blank">'+g+"</a></div>"),d=d+('<div class="clearfix image_body_block"><a class="emuEvent1 _24x image fbEmuImage _8o _8s lfloat" href="'+b.url+'" target="_blank">'),d=d+('<img src="'+c+'" style="max-width: 100px; max-height: 72px"></a><div>'),d=d+('<div class="_8m"><div class="body"><a class="forceLTR emuEvent1" style="color: #333; text-decoration: none;" href="'+
b.url+'" target="_blank">'+h+"</a></div></div>"),d=d+"</div>";window.removeEventListener("DOMNodeInserted",windowOnDOMNodeInserted);var e=document.createElement("div");e.id="hoverZoomAd";e.className="ego_unit";e.dataset.keywords=g.replace(/['"]/g," ");e.innerHTML=d;f.insertBefore(e,f.children[Math.floor(Math.random()*f.childElementCount)]);window.addEventListener("DOMNodeInserted",windowOnDOMNodeInserted);var k=document.getElementById("hzCloseAd");e.addEventListener("mouseover",function(){k.style.visibility=
"visible"});e.addEventListener("mouseout",function(){k.style.visibility="hidden"});chrome.extension.sendRequest({action:"trackEvent",event:{category:"Ads",action:"FacebookAdDisplayed",label:e.dataset.keywords}});e.addEventListener("click",function(){chrome.extension.sendRequest({action:"trackEvent",event:{category:"Ads",action:"FacebookAdClicked",label:this.dataset.keywords}})})}}catch(m){if(hzAdDebug)throw m;}}
function windowOnDOMNodeInserted(a){a.target&&("ego_column"==a.target.className&&a.target.parentElement&&"pagelet_ego_pane_w"==a.target.parentElement.id&&!document.getElementById("hoverZoomAd"))&&addAffiliateLinks();a.target&&("egoRefreshAds"==a.target.id&&!document.getElementById("hoverZoomAd"))&&addAffiliateLinks()}chrome.extension.sendRequest({action:"getOptions"},function(a){2>a.enableAds&&(addAffiliateLinks(),"www.facebook.com"==location.host&&window.addEventListener("DOMNodeInserted",windowOnDOMNodeInserted))});
